# Contributor: Dale Ogilvie <pnyli0002@sneakemail.com>

pkgname=pypy-sword
pkgver=1.6.2
pkgrel=1
pkgdesc="Python bindings for SWORD"
arch=(i686 x86_64)
url="http://www.crosswire.org/sword/index.jsp"
license="GPL"
options=()
depends=('pypy' 'sword' 'swig')
makedepends=('pypy')
replaces=('sword-pypy')
conflicts=('sword-pypy')
source=(http://www.crosswire.org/ftpmirror/pub/sword/source/v1.6/sword-${pkgver}.tar.gz)
md5sums=('a7dc4456e20e915fec46d774b690e305')

build() {
  cd $startdir/src/sword-${pkgver}
  # assume sword built with lucene and icu
  #./configure --prefix=/usr --sysconfdir=/etc --with-lucene --with-icu
  cd bindings/swig/package
  sed -i 's/1\.5\.[[:alnum:]]*/1\.6\.2/g' configure.ac
  libtoolize --force
  ./autogen.sh
  CFLAGS=-fpermissive CXXFLAGS=-fpermissive ./configure --prefix=/usr --sysconfdir=/etc --with-lucene --with-icu --with-python=/usr/bin/pypy
  make pythonswig
  make python_make
}

package() {
  cd $startdir/src/sword-${pkgver}
  cd bindings/swig/package/python
  pypy setup.py install --root=$startdir/pkg
}
