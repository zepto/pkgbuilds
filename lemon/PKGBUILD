# Contributor: Tai Chi Minh Ralph Eastwood

pkgname=lemon
pkgrel=1
pkgver=1.69
pkgdesc="The LEMON LALR Parser Generator used in sqlite $pkgver"
arch=('i686' 'x86_64')
url="http://www.hwaci.com/sw/lemon/"
license=('custom')
depends=()
makedepends=('wget' 'curl')
source=(lemon_share.diff)

_pkgver=`curl -s "http://www.sqlite.org/cvstrac/rlog?f=sqlite/tool/lemon.c" | grep '<span class="vers">' | head -n1 | cut -d '>' -f 2 | cut -d '<' -f 1`
eval pkgver="$_pkgver"

build() {
  cd $srcdir

  mkdir -p lemon
  cp *.diff lemon/
  cd lemon
  wget https://issues.apache.org/jira/secure/attachment/12489616/lemon.c
  wget https://issues.apache.org/jira/secure/attachment/12489617/lempar.c

  patch -Np0 -i lemon_share.diff
  gcc -O3 -o lemon lemon.c

  install -Dm755 lemon $startdir/pkg/usr/bin/lemon
  install -Dm644 lempar.c $startdir/pkg/usr/share/lemon/lempar.c

  rm -rf $srcdir/lemon
}
md5sums=('20eedecfc5dce37ae6ef5055ac3f8a33')
